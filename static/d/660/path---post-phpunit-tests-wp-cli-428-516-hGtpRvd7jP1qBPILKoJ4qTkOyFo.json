{"data":{"mdx":{"id":"5687abaf-eb77-5a5e-b8ff-e18062669b3b","excerpt":"I recently discovered an easy way to add unit tests to my plugins. I've been using WP-CLI for years now to set up new local installs of WordPress and found out…","frontmatter":{"title":"PHPUnit tests and WP-CLI","date":"January 18, 2018","category":["Development"],"featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAZr4nRDMH//EABkQAAMBAQEAAAAAAAAAAAAAAAEDEQACEv/aAAgBAQABBQJSIfA3SeKlxGLLiTf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAABAwUAAAAAAAAAAAAAAAAAAQIRECExMqH/2gAIAQEABj8CuhCtaa9IplT/xAAbEAEBAAIDAQAAAAAAAAAAAAABACExEVFhgf/aAAgBAQABPyHQzLnJD7C1TuhM1yfZmTX/2gAMAwEAAgADAAAAEPff/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB8QAQACAQMFAAAAAAAAAAAAAAERIQAxUcFBcYGRof/aAAgBAQABPxB6vbgBT3p4yApKQDWhDxjQANhYkIIpB6dsKhI0Wj5k0c3o4z//2Q==","aspectRatio":1.4981273408239701,"src":"/static/c628e2538c585dd79014b1da942b18be/81ef8/chuttersnap-pgfWIStWIfs-unsplash.jpg","srcSet":"/static/c628e2538c585dd79014b1da942b18be/c83a6/chuttersnap-pgfWIStWIfs-unsplash.jpg 300w,\n/static/c628e2538c585dd79014b1da942b18be/775d9/chuttersnap-pgfWIStWIfs-unsplash.jpg 600w,\n/static/c628e2538c585dd79014b1da942b18be/81ef8/chuttersnap-pgfWIStWIfs-unsplash.jpg 1200w,\n/static/c628e2538c585dd79014b1da942b18be/989b1/chuttersnap-pgfWIStWIfs-unsplash.jpg 1600w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"featuredImageAccount":"chuttersnap","featuredImagePhotographer":"chuttersnap"},"code":{"body":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nconst layoutProps = {};\nreturn class MDXContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.layout = null;\n  }\n\n  render() {\n    const _this$props = this.props,\n          {\n      components\n    } = _this$props,\n          props = _objectWithoutProperties(_this$props, [\"components\"]);\n\n    return React.createElement(MDXTag, {\n      name: \"wrapper\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `I recently discovered an easy way to add unit tests to my plugins. I’ve been using WP-CLI for years now to set up new local installs of WordPress and found out it has a command specifically for setting up PHPUnit for plugins. This post is partially for my future self so I can remember how to do all this. FYI, I’m on a Mac, so all the commands will be OS X-specific.`), React.createElement(MDXTag, {\n      name: \"h2\",\n      components: components\n    }, `Install and Configure PHPUnit`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Start by installing PHPUnit using Homebrew:`), React.createElement(MDXTag, {\n      name: \"pre\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"code\",\n      components: components,\n      parentName: \"pre\",\n      props: {\n        \"className\": \"language-bash\"\n      }\n    }, `brew install phpunit\n`)), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `That installs the latest version of PHPUnit and makes it ready to use with the global keyword “phpunit”.`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Next, use WP-CLI to setup the test suites and such needed for PHPUnit. I recommend running this command from the plugin’s directory.`), React.createElement(MDXTag, {\n      name: \"pre\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"code\",\n      components: components,\n      parentName: \"pre\",\n      props: {\n        \"className\": \"language-bash\"\n      }\n    }, `wp scaffold plugin-tests my-plugin\n`)), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Replace the “my-plugin” part with your plugin name.`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `If you aren’t already in your plugin directory, change to that now. Then you’ll run the installation bash script.`), React.createElement(MDXTag, {\n      name: \"pre\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"code\",\n      components: components,\n      parentName: \"pre\",\n      props: {\n        \"className\": \"language-bash\"\n      }\n    }, `bin/install-wp-tests.sh wordpress_test root '' localhost latest\n`)), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Notes about this command:`), React.createElement(MDXTag, {\n      name: \"ul\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"li\",\n      components: components,\n      parentName: \"ul\"\n    }, `‘wordpress_test’ is the MySQL database created by this script and used for testing`), React.createElement(MDXTag, {\n      name: \"li\",\n      components: components,\n      parentName: \"ul\"\n    }, `‘root’ is your local MySQL user`), React.createElement(MDXTag, {\n      name: \"li\",\n      components: components,\n      parentName: \"ul\"\n    }, `” is where your local MySQL user password goes`), React.createElement(MDXTag, {\n      name: \"li\",\n      components: components,\n      parentName: \"ul\"\n    }, `‘localhost’ is where your MySQL server is located; ‘localhost’ means its on your computer.`), React.createElement(MDXTag, {\n      name: \"li\",\n      components: components,\n      parentName: \"ul\"\n    }, `‘latest’ changes the version of WordPress to use for testing.`)), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Once you’ve run this script, you’re ready to start writing tests and running them using the ‘phpunit’ command. Here’s the rub though: the script installs WordPress and the testing suite in the /tmp directory. Why is that a  problem? On my computer, at least, the /tmp directory removes anything installed there upon reboot. Which means I need to re-run the tests bash script every time I reboot the computer.`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Since we developers prefer not repeating ourselves, here’s how to configure things for a more permanent solution.`), React.createElement(MDXTag, {\n      name: \"h2\",\n      components: components\n    }, `Solution`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `What I’m advising here is to move the stuff installed in /tmp to somewhere else, then fix all the references so they still work. So, run all of the above, then navigate to your /tmp folder. Move the /wordpress and /wordpress-tests-lib folders to another location outside the /tmp folder. I moved mine into a directory called unittests in my Dropbox folder.`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Go to your Home folder and either open or create the .bash_profile file. You’ll probably need to tell Finder to show Hidden files first. In your .bash_profile file, add the following line, using your new directory location:`), React.createElement(MDXTag, {\n      name: \"pre\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"code\",\n      components: components,\n      parentName: \"pre\",\n      props: {\n        \"className\": \"language-bash\"\n      }\n    }, `export WP_TESTS_DIR=\"/Your/New/Folder/Location/unittests/wordpress-tests-lib\"\n`)), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `This line tells the PHPUnit bootstrap.php file where to find the test WordPress install and test suite files.`), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Now, go to the wordpress-tests-lib directory and open the wp-tests-config.php file. Edit the ABSPATH constant to the ‘/wordpress’ directory you copied over from /tmp earlier. Something like:`), React.createElement(MDXTag, {\n      name: \"pre\",\n      components: components\n    }, React.createElement(MDXTag, {\n      name: \"code\",\n      components: components,\n      parentName: \"pre\",\n      props: {\n        \"className\": \"language-bash\"\n      }\n    }, `define( 'ABSPATH', '/Your/New/Folder/Location/unittests/wordpress//' );\n`)), React.createElement(MDXTag, {\n      name: \"p\",\n      components: components\n    }, `Save the file and reboot your computer. Now, the tests setup by WP-CLI know where the testing WordPress is located, it doesn’t disappear when you install updates or reboot, and you can create and run PHPUnit tests for your plugins!`));\n  }\n\n}"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/phpunit-tests-wp-cli/","previous":{"id":"623707fe-faff-50d1-9b2b-34480859accb","fields":{"slug":"/post/editing-the-readme/"},"frontmatter":{"title":"Editing the README","gallery":null,"category":["WordPress Plugin Boilerplate"]},"code":{"scope":""}},"next":{"id":"5a429da5-b18e-5a77-8926-eba63c327052","fields":{"slug":"/post/code-and-pre-styling/"},"frontmatter":{"title":"Code Sample Styling","gallery":["library","existing-ideas"],"category":["Design"]},"code":{"scope":""}}}}